<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Locate User - MapLibre GL JS</title>
  <script src="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Arial, sans-serif; }
    #map { width: 100%; height: 100vh; }

    .style-selector {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
    }
    .style-selector select {
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      cursor: pointer;
    }

    .info-panel {
      position: absolute;
      bottom: 30px;
      left: 10px;
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      z-index: 1000;
      max-width: 300px;
    }
    .info-panel h3 { margin: 0 0 10px; color: #1a365d; font-size: 16px; }
    .info-panel p { margin: 5px 0; color: #666; font-size: 13px; }
    .info-panel .coords {
      font-family: monospace;
      background: #f0f4f8;
      padding: 8px 12px;
      border-radius: 4px;
      margin-top: 10px;
      font-size: 12px;
    }
    .back-link {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: white;
      padding: 10px 15px;
      border-radius: 6px;
      text-decoration: none;
      color: #1a365d;
      font-weight: 500;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>

<div id="map"></div>

<a href="maplibre-examples-index.html" class="back-link">‚Üê Back to Index</a>

<div class="style-selector">
  <select id="styleSelect" onchange="changeStyle(this.value)">
    <option value="voyager">Voyager (Detailed)</option>
    <option value="positron">Positron (Light)</option>
    <option value="dark">Dark Matter</option>
    <option value="streets">OSM Streets</option>
  </select>
</div>

<div class="info-panel">
  <h3>Locate User</h3>
  <p>Click the location button (top-right) to find your position.</p>
  <p>The map will track your location continuously.</p>
  <div class="coords" id="coords">Location: Not detected</div>
</div>

<script>
  const mapStyles = {
    voyager: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
    positron: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',
    dark: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
    streets: 'https://tiles.openfreemap.org/styles/bright/style.json'
  };

  const map = new maplibregl.Map({
    container: 'map',
    style: mapStyles.voyager,
    center: [54.5, 24.2],
    zoom: 7
  });

  map.addControl(new maplibregl.NavigationControl(), 'bottom-right');

  const geolocate = new maplibregl.GeolocateControl({
    positionOptions: { enableHighAccuracy: true },
    trackUserLocation: true,
    showUserHeading: true,
    showAccuracyCircle: true
  });
  map.addControl(geolocate, 'bottom-right');

  geolocate.on('geolocate', (e) => {
    document.getElementById('coords').innerHTML =
      `Lng: ${e.coords.longitude.toFixed(6)}<br>Lat: ${e.coords.latitude.toFixed(6)}<br>Accuracy: ${e.coords.accuracy.toFixed(1)}m`;
  });

  geolocate.on('error', (e) => {
    document.getElementById('coords').innerHTML = `Error: ${e.message}`;
  });

  function setEnglishLabels() {
    const style = map.getStyle();
    if (!style || !style.layers) return;
    style.layers.forEach(layer => {
      if (layer.type === 'symbol' && layer.layout && layer.layout['text-field']) {
        try { map.setLayoutProperty(layer.id, 'text-field', ['coalesce', ['get', 'name:en'], ['get', 'name']]); } catch (e) {}
      }
    });
  }

  function changeStyle(styleName) {
    map.setStyle(mapStyles[styleName]);
    map.once('style.load', setEnglishLabels);
  }

  map.on('style.load', setEnglishLabels);
</script>
</body>
</html>
