<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Click Symbol - MapLibre GL JS</title>
  <script src="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/map-gl-style-switcher@0.9.2/dist/index.umd.js"></script>
  <link href="https://unpkg.com/map-gl-style-switcher@0.9.2/dist/map-gl-style-switcher.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Arial, sans-serif; }
    #map { width: 100%; height: 100vh; }

    .info-panel {
      position: absolute;
      bottom: 30px;
      left: 10px;
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      z-index: 1000;
      max-width: 300px;
    }
    .info-panel h3 { margin: 0 0 10px; color: #1a365d; font-size: 16px; }
    .info-panel p { margin: 5px 0; color: #666; font-size: 13px; }

    .maplibregl-popup-content {
      padding: 15px 20px;
      border-radius: 8px;
    }
    .popup-title { font-weight: 600; color: #1a365d; margin-bottom: 5px; }
    .popup-desc { color: #666; font-size: 13px; }
    .popup-category {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-top: 8px;
    }
    .cat-landmark { background: #fef3c7; color: #92400e; }
    .cat-beach { background: #dbeafe; color: #1e40af; }
    .cat-culture { background: #dcfce7; color: #166534; }
    .cat-mall { background: #fce7f3; color: #9d174d; }

    .back-link {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: white;
      padding: 10px 15px;
      border-radius: 6px;
      text-decoration: none;
      color: #1a365d;
      font-weight: 500;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>

<div id="map"></div>

<a href="maplibre-examples-index.html" class="back-link">&larr;</a>

<div class="info-panel">
  <h3>Click Symbol to Fly</h3>
  <p>Click any marker to fly to that location and see details.</p>
  <p>Hover over markers to see the pointer cursor.</p>
</div>

<script>
  const mapStyles = {
    voyager: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
    positron: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',
    dark: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json'
  };

  // Style items for the style switcher plugin
  const styleItems = [
    { id: 'voyager', name: 'Voyager', styleUrl: mapStyles.voyager, image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><rect fill="%23f0f4f8" width="40" height="40"/><rect fill="%234299e1" x="5" y="25" width="30" height="10" rx="2"/><rect fill="%2348bb78" x="20" y="5" width="15" height="18" rx="2"/></svg>' },
    { id: 'positron', name: 'Positron', styleUrl: mapStyles.positron, image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><rect fill="%23f7fafc" width="40" height="40"/><rect fill="%23cbd5e0" x="5" y="25" width="30" height="10" rx="2"/><rect fill="%23e2e8f0" x="20" y="5" width="15" height="18" rx="2"/></svg>' },
    { id: 'dark', name: 'Dark Matter', styleUrl: mapStyles.dark, image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><rect fill="%231a202c" width="40" height="40"/><rect fill="%232d3748" x="5" y="25" width="30" height="10" rx="2"/><rect fill="%234a5568" x="20" y="5" width="15" height="18" rx="2"/></svg>' }
  ];

  const landmarks = [
    { coords: [55.2744, 25.1972], name: "Burj Khalifa", desc: "World's tallest building at 828m", category: "landmark" },
    { coords: [55.1378, 25.1122], name: "Palm Jumeirah", desc: "Iconic palm-shaped artificial island", category: "landmark" },
    { coords: [54.4747, 24.4128], name: "Sheikh Zayed Grand Mosque", desc: "One of the world's largest mosques", category: "culture" },
    { coords: [55.1862, 25.0809], name: "Dubai Marina", desc: "Vibrant waterfront district", category: "landmark" },
    { coords: [55.1400, 25.0820], name: "JBR Beach", desc: "Popular public beach with dining", category: "beach" },
    { coords: [55.2796, 25.1982], name: "Dubai Mall", desc: "World's largest shopping mall", category: "mall" },
    { coords: [54.3773, 24.4539], name: "Abu Dhabi Corniche", desc: "8km waterfront promenade", category: "beach" },
    { coords: [54.4341, 24.4601], name: "Louvre Abu Dhabi", desc: "Art and civilization museum", category: "culture" },
    { coords: [55.3046, 25.2486], name: "Dubai Hills Mall", desc: "Modern shopping destination", category: "mall" },
    { coords: [54.5013, 24.4178], name: "Yas Island", desc: "Entertainment and leisure island", category: "landmark" },
  ];

  const categoryColors = {
    landmark: '#f59e0b',
    beach: '#3b82f6',
    culture: '#10b981',
    mall: '#ec4899'
  };

  const map = new maplibregl.Map({
    container: 'map',
    style: mapStyles.voyager,
    center: [54.8, 24.8],
    zoom: 7
  });

  map.addControl(new maplibregl.NavigationControl(), 'bottom-right');
  map.addControl(new maplibregl.GeolocateControl({
    positionOptions: { enableHighAccuracy: true },
    trackUserLocation: true
  }), 'bottom-right');

  // Add style switcher control
  const styleSwitcher = new mapglStyleSwitcher.StyleSwitcherControl({
    styles: styleItems,
    theme: 'auto',
    showLabels: true,
    showImages: true,
    onAfterStyleChange: (from, to) => {
      map.setStyle(to.styleUrl);
      map.once('style.load', () => {
        setEnglishLabels();
        addMarkers();
      });
    }
  });
  map.addControl(styleSwitcher, 'top-left');

  let markers = [];
  let popup = new maplibregl.Popup({ offset: 25, closeButton: true });

  function addMarkers() {
    // Remove existing markers
    markers.forEach(m => m.remove());
    markers = [];

    landmarks.forEach(loc => {
      const el = document.createElement('div');
      el.style.cssText = `
        width: 30px;
        height: 30px;
        background: ${categoryColors[loc.category]};
        border: 3px solid white;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        transition: transform 0.2s;
      `;

      el.addEventListener('mouseenter', () => el.style.transform = 'scale(1.2)');
      el.addEventListener('mouseleave', () => el.style.transform = 'scale(1)');

      el.addEventListener('click', () => {
        map.flyTo({
          center: loc.coords,
          zoom: 15,
          duration: 2000
        });

        popup
          .setLngLat(loc.coords)
          .setHTML(`
            <div class="popup-title">${loc.name}</div>
            <div class="popup-desc">${loc.desc}</div>
            <span class="popup-category cat-${loc.category}">${loc.category}</span>
          `)
          .addTo(map);
      });

      const marker = new maplibregl.Marker(el)
        .setLngLat(loc.coords)
        .addTo(map);

      markers.push(marker);
    });
  }

  map.on('load', addMarkers);

  function setEnglishLabels() {
    const style = map.getStyle();
    if (!style || !style.layers) return;
    style.layers.forEach(layer => {
      if (layer.type === 'symbol' && layer.layout && layer.layout['text-field']) {
        try { map.setLayoutProperty(layer.id, 'text-field', ['coalesce', ['get', 'name:en'], ['get', 'name']]); } catch (e) {}
      }
    });
  }

  map.on('style.load', setEnglishLabels);
</script>
</body>
</html>
